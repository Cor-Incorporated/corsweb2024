---
import { getCurrentLocale, getTranslations } from '../../utils/i18n';

const currentLocale = getCurrentLocale(Astro.url);
const t = getTranslations(currentLocale);

const team = t.teamData;

// リンクタイプ判定関数
function extractLinks(item) {
  const links = [];
  if (item.link) {
    if (item.link.includes('lit.link')) {
      links.push({ type: 'LitLink', url: item.link });
    }
    if (item.link.includes('x.com') || item.link.includes('twitter.com')) {
      links.push({ type: 'X', url: item.link });
    }
  }
  if (item.zennLink) {
    links.push({ type: 'Zenn', url: item.zennLink });
  }
  return links;
}
---

<section class="py-16 sm:py-20">
  <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
    <div class="sm:space-8 space-y-12">
      <h2 class="text-3xl font-medium tracking-tight sm:text-4xl">{t.team.title}</h2>
      <ul role="list" class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
        {
          team.map((item) => (
            <Fragment key={item.name}>
              <li
                class={`rounded-3xl border border-primary-900/10 px-6 py-8 dark:border-primary-300/10 ${
                  item.comingSoon ? 'bg-gray-200 dark:bg-gray-700' : ''
                }`}
              >
                <div class="space-y-6">
                  {/* 画像はitem.linkにリンク */}
                  <a href={item.link} target="_blank">
                    <picture>
                      {/* <source media="(min-width: 1024px)" srcset={item.image.replace('.webp', '-lg.webp')} /> */}
                      {/* <source media="(min-width: 640px)" srcset={item.image.replace('.webp', '-md.webp')} /> */}
                      <img
                        class="mx-auto h-auto w-16 rounded-full"
                        src={item.image}
                        alt={item.name}
                        width="64"
                        height="64"
                        loading="lazy"
                      />
                    </picture>
                  </a>
                  <div class="text-center">
                    <h3 class="text-lg font-medium">
                      {item.comingSoon ? 'Coming Soon...' : item.name}
                    </h3>
                    <p
                      class={`text-base text-primary-950/70 dark:text-primary-200/70 ${
                        item.comingSoon ? 'hidden' : ''
                      }`}
                    >
                      {item.job}
                    </p>
                    {item.description && (
                      <p class="mt-2 text-sm text-primary-950/70 dark:text-primary-200/70">
                        {item.description}
                      </p>
                    )}

                    {/* リンク配列を関数で取得しmapで表示 */}
                    {extractLinks(item).length > 0 && (
                      <div class="mt-2 space-x-2">
                        {extractLinks(item).map((link, idx, arr) => (
                          <Fragment key={link.type}>
                            <a
                              href={link.url}
                              target="_blank"
                              class="text-sm text-primary-600 hover:underline"
                            >
                              {link.type}
                            </a>
                            {idx < arr.length - 1 && (
                              <span class="text-primary-950/50">•</span>
                            )}
                          </Fragment>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </li>
            </Fragment>
          ))
        }
      </ul>
    </div>
  </div>
</section>
